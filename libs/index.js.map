{"version":3,"file":"index.js","sources":["../src/config/request.js","../src/config/config.js","../src/config/api.js","../src/config/util.js","../src/index.js"],"sourcesContent":["class Request {\n    constructor (host) {\n      this.host = host\n    }\n    fetch (requestURL, data, method, resolve, reject) {\n        const url = this.host + requestURL\n        const ks = data.ks\n        delete data.ks\n        ks.request({\n            url,\n            data,\n            method,\n            header: {'content-type': 'application/json'},\n            success (res) {\n                resolve(res)\n            },\n            fail (e) {\n                reject(e)\n            }\n        })\n    }\n    get (url, data) {\n        return new Promise((resolve, reject) => {\n            this.fetch(url, data, 'GET', resolve, reject)\n        })\n    }\n    post (url, data) {\n        return new Promise((resolve, reject) => {\n            this.fetch(url, data, 'POST', resolve, reject)\n        })\n    }\n}\n  \nexport default Request\n  ","import env from './env'\n\nfunction getCurrentEnvUrl (urlMap) {\n  return urlMap[env.IS_ONLINE ? 'pro' : 'dev']\n}\n\n/**\n  * 这里使用了两种环境配置，dev和pro环境\n  * 开发和测试，我们使用dev中的url\n  * 正式环境我们将使用pro中的url\n  */\nexport const payURL = getCurrentEnvUrl({\n  dev: 'https://paym-cashier.guazi-cloud.com',\n  pro: 'https://pay.guazi.com'\n})\n","import Request from './request'\nimport { payURL } from './config'\n\nconst CHANNEL_ORDER = '/paym-cashier/client/create/channelOrder'\nconst PAY_RESULT = '/paym-cashier/client/search/payResult'\n\nconst payRequest = new Request(payURL)\n\nexport default {\n    createChannelOrder (data) {\n        return payRequest.post(CHANNEL_ORDER, data)\n    },\n    getPayResult (data) {\n        return payRequest.get(PAY_RESULT, data)\n    }\n}\n","export const SUCCESS_CODE = '0'","import API from './config/api'\nimport { SUCCESS_CODE } from './config/util'\n\nclass KsPaySDK {\n    constructor (config) {\n        this.config = config\n    }\n    toPay (config) {\n        const { ks, requestSn, open_id } = config\n        const params = {\n            ks,\n            paymentType: '223',\n            requestSn,\n            openId: open_id\n        }\n        ks.showLoading({ title: '加载中' })\n        return new Promise((resolve, reject) => {\n            API.createChannelOrder(params).then(res => {\n                ks.hideLoading()\n                const { code, data, message } = res.data.data\n                console.log('res.data.data', res.data.data)\n                if (code === SUCCESS_CODE && data.appData) {\n                    const { order_no, order_info_token } = JSON.parse(data.appData)\n                    console.log('ks.pay before', ks.pay, order_no, order_info_token)\n                    ks.pay({\n                        serviceId: '1',\n                        orderInfo: {\n                            order_no,\n                            order_info_token\n                        },\n                        success: function success(res) {\n                            return resolve(res)\n                        },\n                        fail: function fail (res) {\n                            return reject(res)\n                        },\n                        complete: function complete (res) {\n                            console.log('complete', res)\n                        }\n                    })\n                } else {\n                    ks.showModal({\n                        showCancel: false,\n                        content: message\n                    })\n                    return reject(message)\n                }\n            })\n        })\n    }\n\n    getPayResult (config) {\n        const { ks, requestSn } = config\n        const params = {\n            ks,\n            requestSn,\n            productType: 'F2F_PAY'\n        }\n        ks.showLoading({ title: '加载中' })\n        return new Promise((resolve, reject) => {\n            API.getPayResult(params).then(res => {\n                ks.hideLoading()\n                const { code, data, message } = res.data.data\n                if (code === SUCCESS_CODE) {\n                    return resolve(data)\n                } else {\n                    return reject(message)\n                }\n            })\n        })\n    }\n}\n\nconst ksPaySdk = new KsPaySDK()\n\nexport const toPay = ksPaySdk.toPay\nexport const getPayResult = ksPaySdk.getPayResult\n// module.exports = ksPaySdk"],"names":["Request","host","requestURL","data","method","resolve","reject","url","ks","request","header","success","res","fail","e","Promise","fetch","getCurrentEnvUrl","urlMap","payURL","dev","pro","CHANNEL_ORDER","PAY_RESULT","payRequest","createChannelOrder","post","getPayResult","get","SUCCESS_CODE","KsPaySDK","config","requestSn","open_id","params","paymentType","openId","showLoading","title","API","then","hideLoading","code","message","console","log","appData","JSON","parse","order_no","order_info_token","pay","serviceId","orderInfo","complete","showModal","showCancel","content","productType","ksPaySdk","toPay"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;IAAMA;AACF,mBAAaC,IAAb,EAAmB;AAAA;;AACjB,SAAKA,IAAL,GAAYA,IAAZ;AACD;;;;WACD,eAAOC,UAAP,EAAmBC,IAAnB,EAAyBC,MAAzB,EAAiCC,OAAjC,EAA0CC,MAA1C,EAAkD;AAC9C,UAAMC,GAAG,GAAG,KAAKN,IAAL,GAAYC,UAAxB;AACA,UAAMM,EAAE,GAAGL,IAAI,CAACK,EAAhB;AACA,aAAOL,IAAI,CAACK,EAAZ;AACAA,MAAAA,EAAE,CAACC,OAAH,CAAW;AACPF,QAAAA,GAAG,EAAHA,GADO;AAEPJ,QAAAA,IAAI,EAAJA,IAFO;AAGPC,QAAAA,MAAM,EAANA,MAHO;AAIPM,QAAAA,MAAM,EAAE;AAAC,0BAAgB;AAAjB,SAJD;AAKPC,QAAAA,OALO,mBAKEC,GALF,EAKO;AACVP,UAAAA,OAAO,CAACO,GAAD,CAAP;AACH,SAPM;AAQPC,QAAAA,IARO,gBAQDC,CARC,EAQE;AACLR,UAAAA,MAAM,CAACQ,CAAD,CAAN;AACH;AAVM,OAAX;AAYH;;;WACD,aAAKP,GAAL,EAAUJ,IAAV,EAAgB;AAAA;;AACZ,aAAO,IAAIY,OAAJ,CAAY,UAACV,OAAD,EAAUC,MAAV,EAAqB;AACpC,QAAA,KAAI,CAACU,KAAL,CAAWT,GAAX,EAAgBJ,IAAhB,EAAsB,KAAtB,EAA6BE,OAA7B,EAAsCC,MAAtC;AACH,OAFM,CAAP;AAGH;;;WACD,cAAMC,GAAN,EAAWJ,IAAX,EAAiB;AAAA;;AACb,aAAO,IAAIY,OAAJ,CAAY,UAACV,OAAD,EAAUC,MAAV,EAAqB;AACpC,QAAA,MAAI,CAACU,KAAL,CAAWT,GAAX,EAAgBJ,IAAhB,EAAsB,MAAtB,EAA8BE,OAA9B,EAAuCC,MAAvC;AACH,OAFM,CAAP;AAGH;;;;;;AC5BL,SAASW,gBAAT,CAA2BC,MAA3B,EAAmC;AACjC,SAAOA,MAAM,CAAyB,KAAzB,CAAb;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,IAAMC,MAAM,GAAGF,gBAAgB,CAAC;AACrCG,EAAAA,GAAG,EAAE,sCADgC;AAErCC,EAAAA,GAAG,EAAE;AAFgC,CAAD,CAA/B;;ACRP,IAAMC,aAAa,GAAG,0CAAtB;AACA,IAAMC,UAAU,GAAG,uCAAnB;AAEA,IAAMC,UAAU,GAAG,IAAIxB,OAAJ,CAAYmB,MAAZ,CAAnB;AAEA,UAAe;AACXM,EAAAA,kBADW,8BACStB,IADT,EACe;AACtB,WAAOqB,UAAU,CAACE,IAAX,CAAgBJ,aAAhB,EAA+BnB,IAA/B,CAAP;AACH,GAHU;AAIXwB,EAAAA,YAJW,wBAIGxB,IAJH,EAIS;AAChB,WAAOqB,UAAU,CAACI,GAAX,CAAeL,UAAf,EAA2BpB,IAA3B,CAAP;AACH;AANU,CAAf;;ACRO,IAAM0B,YAAY,GAAG,GAArB;;ICGDC;AACF,oBAAaC,MAAb,EAAqB;AAAA;;AACjB,SAAKA,MAAL,GAAcA,MAAd;AACH;;;;WACD,eAAOA,MAAP,EAAe;AACX,UAAQvB,EAAR,GAAmCuB,MAAnC,CAAQvB,EAAR;AAAA,UAAYwB,SAAZ,GAAmCD,MAAnC,CAAYC,SAAZ;AAAA,UAAuBC,OAAvB,GAAmCF,MAAnC,CAAuBE,OAAvB;AACA,UAAMC,MAAM,GAAG;AACX1B,QAAAA,EAAE,EAAFA,EADW;AAEX2B,QAAAA,WAAW,EAAE,KAFF;AAGXH,QAAAA,SAAS,EAATA,SAHW;AAIXI,QAAAA,MAAM,EAAEH;AAJG,OAAf;AAMAzB,MAAAA,EAAE,CAAC6B,WAAH,CAAe;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAf;AACA,aAAO,IAAIvB,OAAJ,CAAY,UAACV,OAAD,EAAUC,MAAV,EAAqB;AACpCiC,QAAAA,GAAG,CAACd,kBAAJ,CAAuBS,MAAvB,EAA+BM,IAA/B,CAAoC,UAAA5B,GAAG,EAAI;AACvCJ,UAAAA,EAAE,CAACiC,WAAH;AACA,+BAAgC7B,GAAG,CAACT,IAAJ,CAASA,IAAzC;AAAA,cAAQuC,IAAR,kBAAQA,IAAR;AAAA,cAAcvC,IAAd,kBAAcA,IAAd;AAAA,cAAoBwC,OAApB,kBAAoBA,OAApB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BjC,GAAG,CAACT,IAAJ,CAASA,IAAtC;;AACA,cAAIuC,IAAI,KAAKb,YAAT,IAAyB1B,IAAI,CAAC2C,OAAlC,EAA2C;AACvC,8BAAuCC,IAAI,CAACC,KAAL,CAAW7C,IAAI,CAAC2C,OAAhB,CAAvC;AAAA,gBAAQG,QAAR,eAAQA,QAAR;AAAA,gBAAkBC,gBAAlB,eAAkBA,gBAAlB;;AACAN,YAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BrC,EAAE,CAAC2C,GAAhC,EAAqCF,QAArC,EAA+CC,gBAA/C;AACA1C,YAAAA,EAAE,CAAC2C,GAAH,CAAO;AACHC,cAAAA,SAAS,EAAE,GADR;AAEHC,cAAAA,SAAS,EAAE;AACPJ,gBAAAA,QAAQ,EAARA,QADO;AAEPC,gBAAAA,gBAAgB,EAAhBA;AAFO,eAFR;AAMHvC,cAAAA,OAAO,EAAE,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAC3B,uBAAOP,OAAO,CAACO,GAAD,CAAd;AACH,eARE;AASHC,cAAAA,IAAI,EAAE,SAASA,IAAT,CAAeD,GAAf,EAAoB;AACtB,uBAAON,MAAM,CAACM,GAAD,CAAb;AACH,eAXE;AAYH0C,cAAAA,QAAQ,EAAE,SAASA,QAAT,CAAmB1C,GAAnB,EAAwB;AAC9BgC,gBAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBjC,GAAxB;AACH;AAdE,aAAP;AAgBH,WAnBD,MAmBO;AACHJ,YAAAA,EAAE,CAAC+C,SAAH,CAAa;AACTC,cAAAA,UAAU,EAAE,KADH;AAETC,cAAAA,OAAO,EAAEd;AAFA,aAAb;AAIA,mBAAOrC,MAAM,CAACqC,OAAD,CAAb;AACH;AACJ,SA9BD;AA+BH,OAhCM,CAAP;AAiCH;;;WAED,sBAAcZ,MAAd,EAAsB;AAClB,UAAQvB,EAAR,GAA0BuB,MAA1B,CAAQvB,EAAR;AAAA,UAAYwB,SAAZ,GAA0BD,MAA1B,CAAYC,SAAZ;AACA,UAAME,MAAM,GAAG;AACX1B,QAAAA,EAAE,EAAFA,EADW;AAEXwB,QAAAA,SAAS,EAATA,SAFW;AAGX0B,QAAAA,WAAW,EAAE;AAHF,OAAf;AAKAlD,MAAAA,EAAE,CAAC6B,WAAH,CAAe;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAf;AACA,aAAO,IAAIvB,OAAJ,CAAY,UAACV,OAAD,EAAUC,MAAV,EAAqB;AACpCiC,QAAAA,GAAG,CAACZ,YAAJ,CAAiBO,MAAjB,EAAyBM,IAAzB,CAA8B,UAAA5B,GAAG,EAAI;AACjCJ,UAAAA,EAAE,CAACiC,WAAH;AACA,gCAAgC7B,GAAG,CAACT,IAAJ,CAASA,IAAzC;AAAA,cAAQuC,IAAR,mBAAQA,IAAR;AAAA,cAAcvC,IAAd,mBAAcA,IAAd;AAAA,cAAoBwC,OAApB,mBAAoBA,OAApB;;AACA,cAAID,IAAI,KAAKb,YAAb,EAA2B;AACvB,mBAAOxB,OAAO,CAACF,IAAD,CAAd;AACH,WAFD,MAEO;AACH,mBAAOG,MAAM,CAACqC,OAAD,CAAb;AACH;AACJ,SARD;AASH,OAVM,CAAP;AAWH;;;;;;AAGL,IAAMgB,QAAQ,GAAG,IAAI7B,QAAJ,EAAjB;IAEa8B,KAAK,GAAGD,QAAQ,CAACC;IACjBjC,YAAY,GAAGgC,QAAQ,CAAChC;;;;;"}